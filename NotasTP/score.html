<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 5 Trabajo Practico | Politica Economica II</title>
  <meta name="description" content="UNLP" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 5 Trabajo Practico | Politica Economica II" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="UNLP" />
  <meta name="github-repo" content="msangia/msangia.github" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 5 Trabajo Practico | Politica Economica II" />
  <meta name="twitter:site" content="@msangia" />
  <meta name="twitter:description" content="UNLP" />
  

<meta name="author" content="Máximo Sangiácomo" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="arboles.html"/>
<link rel="next" href="bibliografia.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<html>
  <head>
	<link rel="shortcut icon" href="images/favicon.png" />
  </head>
  <body>
  </body>
</html>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/r4ds.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Politica Economica II - UNLP</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Descripcion del curso</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduccion a R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#primeros-pasos"><i class="fa fa-check"></i><b>1.1</b> Primeros pasos</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#busacar-ayuda"><i class="fa fa-check"></i><b>1.2</b> Busacar ayuda</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#tipos-de-datos"><i class="fa fa-check"></i><b>1.3</b> Tipos de datos</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#limpieza-de-memoria"><i class="fa fa-check"></i><b>1.4</b> Limpieza de memoria</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#asignación-de-valores"><i class="fa fa-check"></i><b>1.5</b> Asignación de valores</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#operadores-aritméticos"><i class="fa fa-check"></i><b>1.6</b> Operadores aritméticos</a></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#operadores-relacionales"><i class="fa fa-check"></i><b>1.7</b> Operadores relacionales</a></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#operadores-lógicos"><i class="fa fa-check"></i><b>1.8</b> Operadores lógicos</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="bd.html"><a href="bd.html"><i class="fa fa-check"></i><b>2</b> Base de datos</a>
<ul>
<li class="chapter" data-level="2.1" data-path="bd.html"><a href="bd.html#directorio-de-trabajo"><i class="fa fa-check"></i><b>2.1</b> Directorio de trabajo</a></li>
<li class="chapter" data-level="2.2" data-path="bd.html"><a href="bd.html#cargar-datos"><i class="fa fa-check"></i><b>2.2</b> Cargar datos</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="bd.html"><a href="bd.html#ingrasar-datos-con-tidyverse"><i class="fa fa-check"></i><b>2.2.1</b> Ingrasar datos con <code>tidyverse</code></a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="bd.html"><a href="bd.html#exportar-datos"><i class="fa fa-check"></i><b>2.3</b> Exportar datos</a></li>
<li class="chapter" data-level="2.4" data-path="bd.html"><a href="bd.html#variables"><i class="fa fa-check"></i><b>2.4</b> Variables</a></li>
<li class="chapter" data-level="2.5" data-path="bd.html"><a href="bd.html#merge"><i class="fa fa-check"></i><b>2.5</b> Merge</a></li>
<li class="chapter" data-level="2.6" data-path="bd.html"><a href="bd.html#variables-group_by-mutate"><i class="fa fa-check"></i><b>2.6</b> Variables: group_by, mutate</a></li>
<li class="chapter" data-level="2.7" data-path="bd.html"><a href="bd.html#guardar-datos"><i class="fa fa-check"></i><b>2.7</b> Guardar datos</a></li>
<li class="chapter" data-level="2.8" data-path="bd.html"><a href="bd.html#valores-missing"><i class="fa fa-check"></i><b>2.8</b> Valores missing</a></li>
<li class="chapter" data-level="2.9" data-path="bd.html"><a href="bd.html#análisis-de-datos"><i class="fa fa-check"></i><b>2.9</b> Análisis de datos</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="bd.html"><a href="bd.html#tablas"><i class="fa fa-check"></i><b>2.9.1</b> Tablas</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="bd.html"><a href="bd.html#group_by-summarise"><i class="fa fa-check"></i><b>2.10</b> group_by, summarise</a></li>
<li class="chapter" data-level="2.11" data-path="bd.html"><a href="bd.html#gráficos"><i class="fa fa-check"></i><b>2.11</b> Gráficos</a></li>
<li class="chapter" data-level="2.12" data-path="bd.html"><a href="bd.html#ggplot"><i class="fa fa-check"></i><b>2.12</b> GGPlot</a></li>
<li class="chapter" data-level="2.13" data-path="bd.html"><a href="bd.html#guardar-un-gráfico"><i class="fa fa-check"></i><b>2.13</b> Guardar un gráfico</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="conceptos.html"><a href="conceptos.html"><i class="fa fa-check"></i><b>3</b> Conceptos generales</a>
<ul>
<li class="chapter" data-level="3.1" data-path="conceptos.html"><a href="conceptos.html#estimacion"><i class="fa fa-check"></i><b>3.1</b> Estimacion</a></li>
<li class="chapter" data-level="3.2" data-path="conceptos.html"><a href="conceptos.html#prediccion"><i class="fa fa-check"></i><b>3.2</b> Prediccion</a></li>
<li class="chapter" data-level="3.3" data-path="conceptos.html"><a href="conceptos.html#metodos-parametricos"><i class="fa fa-check"></i><b>3.3</b> Metodos parametricos</a></li>
<li class="chapter" data-level="3.4" data-path="conceptos.html"><a href="conceptos.html#metodos-no-parametricos"><i class="fa fa-check"></i><b>3.4</b> Metodos no parametricos</a></li>
<li class="chapter" data-level="3.5" data-path="conceptos.html"><a href="conceptos.html#evaluacion-de-la-precision-del-modelo"><i class="fa fa-check"></i><b>3.5</b> Evaluacion de la precision del modelo</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="conceptos.html"><a href="conceptos.html#ajuste"><i class="fa fa-check"></i><b>3.5.1</b> Calidad del ajuste</a></li>
<li class="chapter" data-level="3.5.2" data-path="conceptos.html"><a href="conceptos.html#trade-off-sesgo-varianza"><i class="fa fa-check"></i><b>3.5.2</b> Trade-off Sesgo-Varianza</a></li>
<li class="chapter" data-level="3.5.3" data-path="conceptos.html"><a href="conceptos.html#clasificacion"><i class="fa fa-check"></i><b>3.5.3</b> Clasificacion</a></li>
<li class="chapter" data-level="3.5.4" data-path="conceptos.html"><a href="conceptos.html#confusion"><i class="fa fa-check"></i><b>3.5.4</b> Matriz de confusion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="arboles.html"><a href="arboles.html"><i class="fa fa-check"></i><b>4</b> Arboles de decision</a>
<ul>
<li class="chapter" data-level="4.1" data-path="arboles.html"><a href="arboles.html#classification-and-regression-tree-cart"><i class="fa fa-check"></i><b>4.1</b> <em>Classification and Regression Tree</em> (CART)</a></li>
<li class="chapter" data-level="4.2" data-path="arboles.html"><a href="arboles.html#bagging"><i class="fa fa-check"></i><b>4.2</b> Bagging</a></li>
<li class="chapter" data-level="4.3" data-path="arboles.html"><a href="arboles.html#random-forest"><i class="fa fa-check"></i><b>4.3</b> Random Forest</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="score.html"><a href="score.html"><i class="fa fa-check"></i><b>5</b> Trabajo Practico</a>
<ul>
<li class="chapter" data-level="5.1" data-path="score.html"><a href="score.html#reglas-del-trabajo-practico"><i class="fa fa-check"></i><b>5.1</b> Reglas del Trabajo practico</a></li>
<li class="chapter" data-level="5.2" data-path="score.html"><a href="score.html#enunciado-del-trabajo-practico"><i class="fa fa-check"></i><b>5.2</b> Enunciado del Trabajo Practico</a></li>
<li class="chapter" data-level="5.3" data-path="score.html"><a href="score.html#aplicacion-practica"><i class="fa fa-check"></i><b>5.3</b> Aplicacion practica</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bibliografia.html"><a href="bibliografia.html"><i class="fa fa-check"></i>Bibliografia</a></li>
<li class="divider"></li>
<li><a href="./" target="blank">Maximo Sangiacomo</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Politica Economica II</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<link href="css/style.css" rel="stylesheet">
<div class="hero-image-container"> 
  <img class= "hero-image" src="images/background.jpg">
</div>
<div id="score" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Capítulo 5</span> Trabajo Practico<a href="score.html#score" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="reglas-del-trabajo-practico" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Reglas del Trabajo practico<a href="score.html#reglas-del-trabajo-practico" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p><strong>Integrantes:</strong> máximo 3 por grupo.</p></li>
<li><p><strong>Extensión:</strong> máximo 8 carillas (hoja A4, 12pts, etc.). La página 9 <strong>no se corrige.</strong></p></li>
<li><p><strong>Copia o plagio:</strong> trabajo desaprobado, grupo fuera del régimen de promoción.</p></li>
<li><p><strong>Redacción:</strong> Formal.</p></li>
<li><p><strong>Presentación:</strong> tablas/cuadros bien descriptas y ordenadas.</p></li>
<li><p><strong>Bases de datos:</strong> a definir diferenciando por grupos.</p></li>
<li><p>Sugerencias bibliográficas:</p>
<ul>
<li>Fortalezas y debilidades de la evaluación de créditos con técnicas de <em>machine learning</em> <span class="citation">(<a href="#ref-Bazarbash19" role="doc-biblioref">Bazarbash 2019</a>)</span>.</li>
<li><em>Performance</em> predictiva <span class="citation">(<a href="#ref-Frost19" role="doc-biblioref">Frost et al. 2019</a>)</span>.</li>
<li><em>Performance</em> predictiva <span class="citation">(<a href="#ref-Petropoulos18" role="doc-biblioref">Petropoulos et al. 2018</a>)</span>.</li>
</ul></li>
</ol>
</div>
<div id="enunciado-del-trabajo-practico" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Enunciado del Trabajo Practico<a href="score.html#enunciado-del-trabajo-practico" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>En base a lo desarrollado en las clases teóricas se busca que elaboren un modelo de <em>scoring</em> que permita discriminar entre buenos y malos deudores.</p>
<ol style="list-style-type: decimal">
<li>Realizar una revisión de la literatura teórica y empírica para elaborar una sección que describa:</li>
</ol>
<ul>
<li>¿Por qué es importante el problema a analizar?</li>
<li>Ventajas y desventajas de enfoques tradicionales vs. <em>machine learning</em>.</li>
<li>Los principales resultados encontrados.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><p>Presentar, describir y analizar los datos utilizados.</p></li>
<li><p>Presentar e interpretar los principales resultados de un modelo <em>logit</em> en comparación con técnicas de árboles.</p></li>
<li><p>Elaborar conclusiones de política.</p></li>
</ol>
</div>
<div id="aplicacion-practica" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Aplicacion practica<a href="score.html#aplicacion-practica" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>La irrupción de las firmas <em>BigTech</em> en la provisión de crédito está modificando la estructura del sistema financiero. Si bien la actividad principal de estas compañías es la provisión de servicios digitales como el <em>e-commerce</em> y servicios de pago paulatinamente han ido incorporando otros productos como la provisión de crédito, seguros, inversiones y ahorro.</p>
<p>El modelo de negocios de las <em>BigTech</em> difiere del modelo de las entidades financieras tradicionales principalmente por dos factores distintivos: efectos de red (generados por las plataformas de <em>e-commerce</em>, aplicaciones de mensajería y redes sociales); el uso de la tecnología (inteligencia artificial utilizando <em>big data</em>).</p>
<p>La utilización de nuevas técnicas de análisis y fuentes de datos alternativos brindan a las empresas tecnológicas una ventaja informativa para la evaluación de deudores respecto de las entidades financieras, que utilizan métodos econométricos convencionales (ej. estimaciones <em>logit</em>) menos flexibles para capturar la información contenida en grandes volúmenes de datos.</p>
<p>En esta sección se utiliza una base de datos bancaria para predecir la probabilidad de <em>default</em> con distintas metodologías, un modelo <em>logit</em>, un árbol simple y un <em>random forest</em>, para comparar las capacidades predictivas.</p>
<p>Primero se limpia la memoria y se cargan las librerías que vamos a utilizar.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="score.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Limpiar memoria</span></span>
<span id="cb94-2"><a href="score.html#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb94-3"><a href="score.html#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<pre><code>##           used  (Mb) gc trigger  (Mb) max used  (Mb)
## Ncells 2354193 125.8    3999404 213.6  3999404 213.6
## Vcells 4080023  31.2    8388608  64.0  6514481  49.8</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="score.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Librerias</span></span>
<span id="cb96-2"><a href="score.html#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb96-3"><a href="score.html#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)</span>
<span id="cb96-4"><a href="score.html#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(yardstick)</span>
<span id="cb96-5"><a href="score.html#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb96-6"><a href="score.html#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb96-7"><a href="score.html#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb96-8"><a href="score.html#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code></pre></div>
<p>Se cargan los datos desde un archivo separado por comas y se analizan los valores <em>missing</em>.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="score.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar datos</span></span>
<span id="cb97-2"><a href="score.html#cb97-2" aria-hidden="true" tabindex="-1"></a>score_data_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&#39;./data/CreditScore1.csv&#39;</span>)</span>
<span id="cb97-3"><a href="score.html#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="score.html#cb97-4" aria-hidden="true" tabindex="-1"></a>score_data_raw <span class="sc">%&gt;%</span></span>
<span id="cb97-5"><a href="score.html#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb97-6"><a href="score.html#cb97-6" aria-hidden="true" tabindex="-1"></a>  reshape2<span class="sc">::</span><span class="fu">melt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb97-7"><a href="score.html#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Var2, Var1, <span class="at">fill=</span>value)) <span class="sc">+</span> </span>
<span id="cb97-8"><a href="score.html#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb97-9"><a href="score.html#cb97-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb97-10"><a href="score.html#cb97-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb97-11"><a href="score.html#cb97-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Dato&quot;</span>, </span>
<span id="cb97-12"><a href="score.html#cb97-12" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Missing&quot;</span>)) <span class="sc">+</span></span>
<span id="cb97-13"><a href="score.html#cb97-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x=</span> <span class="st">&#39;Variable&#39;</span>, <span class="at">title=</span> <span class="st">&#39;Valores missing&#39;</span>) <span class="sc">+</span></span>
<span id="cb97-14"><a href="score.html#cb97-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb97-15"><a href="score.html#cb97-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb97-16"><a href="score.html#cb97-16" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span></code></pre></div>
<p><img src="NotasTP_files/figure-html/tp2-1.png" width="672" height="40%" style="display: block; margin: auto;" /></p>
<p>La variable <code>ingreso</code> es la que mayormente presenta observaciones con valores <em>missing</em>, dado que no existe una forma obvia de imputación y que tenemos 150.000 observaciones en total (y no se pierden tantas…), se eliminan las filas correspondientes.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="score.html#cb98-1" aria-hidden="true" tabindex="-1"></a>score_data_tbl <span class="ot">&lt;-</span> score_data_raw <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="score.html#cb98-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span></code></pre></div>
<p>Se realiza una inspección inicial de la base de datos.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="score.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(score_data_tbl)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 10
##   default personal_total  edad nro_atraso3059 gastos_ingreso ingreso
##     &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;   &lt;dbl&gt;
## 1       1          0.766    45              2         0.803     9120
## 2       0          0.957    40              0         0.122     2600
## 3       0          0.658    38              1         0.0851    3042
## 4       0          0.234    30              0         0.0360    3300
## 5       0          0.907    49              1         0.0249   63588
## 6       0          0.213    74              0         0.376     3500
## # … with 4 more variables: lineas_credito &lt;dbl&gt;, nro_atraso90 &lt;dbl&gt;,
## #   nro_hipoteca &lt;dbl&gt;, familia &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="score.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(score_data_tbl)</span></code></pre></div>
<pre><code>## Rows: 120,269
## Columns: 10
## $ default        &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1…
## $ personal_total &lt;dbl&gt; 0.76612663, 0.95715100, 0.65818012, 0.23380977, 0.90723…
## $ edad           &lt;dbl&gt; 45, 40, 38, 30, 49, 74, 39, 57, 30, 51, 46, 40, 76, 64,…
## $ nro_atraso3059 &lt;dbl&gt; 2, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0…
## $ gastos_ingreso &lt;dbl&gt; 0.80298215, 0.12187620, 0.08511338, 0.03604968, 0.02492…
## $ ingreso        &lt;dbl&gt; 9120, 2600, 3042, 3300, 63588, 3500, 3500, 23684, 2500,…
## $ lineas_credito &lt;dbl&gt; 13, 4, 2, 5, 7, 3, 8, 9, 5, 7, 13, 9, 6, 7, 7, 7, 2, 10…
## $ nro_atraso90   &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0…
## $ nro_hipoteca   &lt;dbl&gt; 6, 0, 0, 0, 1, 1, 0, 4, 0, 2, 2, 1, 1, 1, 0, 1, 0, 2, 1…
## $ familia        &lt;dbl&gt; 2, 1, 0, 0, 0, 1, 0, 2, 0, 2, 2, 2, 0, 2, 0, 2, 0, 0, 2…</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="score.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(score_data_tbl)</span></code></pre></div>
<pre><code>##     default        personal_total          edad        nro_atraso3059   
##  Min.   :0.00000   Min.   :    0.00   Min.   :  0.00   Min.   : 0.0000  
##  1st Qu.:0.00000   1st Qu.:    0.04   1st Qu.: 40.00   1st Qu.: 0.0000  
##  Median :0.00000   Median :    0.18   Median : 51.00   Median : 0.0000  
##  Mean   :0.06949   Mean   :    5.90   Mean   : 51.29   Mean   : 0.3818  
##  3rd Qu.:0.00000   3rd Qu.:    0.58   3rd Qu.: 61.00   3rd Qu.: 0.0000  
##  Max.   :1.00000   Max.   :50708.00   Max.   :103.00   Max.   :98.0000  
##  gastos_ingreso        ingreso        lineas_credito    nro_atraso90    
##  Min.   :    0.00   Min.   :      0   Min.   : 0.000   Min.   : 0.0000  
##  1st Qu.:    0.14   1st Qu.:   3400   1st Qu.: 5.000   1st Qu.: 0.0000  
##  Median :    0.30   Median :   5400   Median : 8.000   Median : 0.0000  
##  Mean   :   26.60   Mean   :   6670   Mean   : 8.758   Mean   : 0.2119  
##  3rd Qu.:    0.48   3rd Qu.:   8249   3rd Qu.:11.000   3rd Qu.: 0.0000  
##  Max.   :61106.50   Max.   :3008750   Max.   :58.000   Max.   :98.0000  
##   nro_hipoteca       familia       
##  Min.   : 0.000   Min.   : 0.0000  
##  1st Qu.: 0.000   1st Qu.: 0.0000  
##  Median : 1.000   Median : 0.0000  
##  Mean   : 1.055   Mean   : 0.8518  
##  3rd Qu.: 2.000   3rd Qu.: 2.0000  
##  Max.   :54.000   Max.   :20.0000</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="score.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(score_data_tbl<span class="sc">$</span>familia))</span></code></pre></div>
<pre><code>##  [1]  0  1  2  3  4  5  6  7  8  9 10 13 20</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="score.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(score_data_tbl<span class="sc">$</span>default)</span></code></pre></div>
<pre><code>## 
##      0      1 
## 111912   8357</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="score.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Porcentaje de positivos</span></span>
<span id="cb109-2"><a href="score.html#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="dv">8357</span> <span class="sc">/</span> (<span class="dv">8357</span> <span class="sc">+</span> <span class="dv">111912</span>)</span></code></pre></div>
<pre><code>## [1] 0.0694859</code></pre>
<p>Luego, se calculan algunas estadísticas descriptivas.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="score.html#cb111-1" aria-hidden="true" tabindex="-1"></a>stat <span class="ot">=</span> score_data_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb111-2"><a href="score.html#cb111-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select_if</span>(is.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb111-3"><a href="score.html#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&#39;Variable&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;Value&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb111-4"><a href="score.html#cb111-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Variable) <span class="sc">%&gt;%</span> </span>
<span id="cb111-5"><a href="score.html#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb111-6"><a href="score.html#cb111-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Obs =</span> <span class="fu">n</span>(),</span>
<span id="cb111-7"><a href="score.html#cb111-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Media =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm =</span> T),</span>
<span id="cb111-8"><a href="score.html#cb111-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mediana =</span> <span class="fu">median</span>(Value, <span class="at">na.rm =</span> T),</span>
<span id="cb111-9"><a href="score.html#cb111-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">SD =</span> <span class="fu">sd</span>(Value, <span class="at">na.rm =</span> T),</span>
<span id="cb111-10"><a href="score.html#cb111-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Min =</span> <span class="fu">min</span>(Value, <span class="at">na.rm =</span> T),</span>
<span id="cb111-11"><a href="score.html#cb111-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Max =</span> <span class="fu">max</span>(Value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb111-12"><a href="score.html#cb111-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb111-13"><a href="score.html#cb111-13" aria-hidden="true" tabindex="-1"></a>stat</span></code></pre></div>
<pre><code>## # A tibble: 10 × 7
##    Variable          Obs     Media  Mediana        SD   Min      Max
##    &lt;chr&gt;           &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
##  1 default        120269    0.0695    0         0.254     0       1 
##  2 edad           120269   51.3      51        14.4       0     103 
##  3 familia        120269    0.852     0         1.15      0      20 
##  4 gastos_ingreso 120269   26.6       0.296   424.        0   61106.
##  5 ingreso        120269 6670.     5400     14385.        0 3008750 
##  6 lineas_credito 120269    8.76      8         5.17      0      58 
##  7 nro_atraso3059 120269    0.382     0         3.50      0      98 
##  8 nro_atraso90   120269    0.212     0         3.47      0      98 
##  9 nro_hipoteca   120269    1.05      1         1.15      0      54 
## 10 personal_total 120269    5.90      0.177   257.        0   50708</code></pre>
<p>Se procede a realizar el <em>feature engineering</em> o creación de variables…notar que la capacidad de clasificación depende de los atributos disponibles y los valores de los hiperpárametros.<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a></p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="score.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformacion</span></span>
<span id="cb113-2"><a href="score.html#cb113-2" aria-hidden="true" tabindex="-1"></a>score_data_tbl <span class="ot">=</span> score_data_tbl <span class="sc">%&gt;%</span></span>
<span id="cb113-3"><a href="score.html#cb113-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">mutate</span>(</span>
<span id="cb113-4"><a href="score.html#cb113-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">default =</span> <span class="fu">factor</span>(default),</span>
<span id="cb113-5"><a href="score.html#cb113-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ingreso =</span> <span class="fu">log</span>(<span class="dv">1</span><span class="sc">+</span>ingreso), </span>
<span id="cb113-6"><a href="score.html#cb113-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">familia_bin =</span> <span class="fu">case_when</span>(familia <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb113-7"><a href="score.html#cb113-7" aria-hidden="true" tabindex="-1"></a>                                            familia <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb113-8"><a href="score.html#cb113-8" aria-hidden="true" tabindex="-1"></a>                                            familia <span class="sc">&gt;=</span> <span class="dv">2</span><span class="sc">&amp;</span>familia <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb113-9"><a href="score.html#cb113-9" aria-hidden="true" tabindex="-1"></a>                                            familia <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">4</span>))</span>
<span id="cb113-10"><a href="score.html#cb113-10" aria-hidden="true" tabindex="-1"></a>score_data_tbl <span class="ot">=</span> score_data_tbl <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>familia)</span></code></pre></div>
<p>Se divide la muestra en <span class="math inline">\(80\%\)</span> para entrenamiento y <span class="math inline">\(20\%\)</span> para <em>test</em>.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="score.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train / Test split</span></span>
<span id="cb114-2"><a href="score.html#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb114-3"><a href="score.html#cb114-3" aria-hidden="true" tabindex="-1"></a>train_test_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(score_data_tbl, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb114-4"><a href="score.html#cb114-4" aria-hidden="true" tabindex="-1"></a>train_test_split</span></code></pre></div>
<pre><code>## &lt;Analysis/Assess/Total&gt;
## &lt;96215/24054/120269&gt;</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="score.html#cb116-1" aria-hidden="true" tabindex="-1"></a>train_tbl <span class="ot">&lt;-</span> <span class="fu">training</span>(train_test_split)</span>
<span id="cb116-2"><a href="score.html#cb116-2" aria-hidden="true" tabindex="-1"></a>test_tbl  <span class="ot">&lt;-</span> <span class="fu">testing</span>(train_test_split) </span></code></pre></div>
<p>Se definen dos objetos para utilizar más abajo.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="score.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Formula</span></span>
<span id="cb117-2"><a href="score.html#cb117-2" aria-hidden="true" tabindex="-1"></a>formula  <span class="ot">&lt;-</span>  <span class="fu">formula</span>(default <span class="sc">~</span> .)</span>
<span id="cb117-3"><a href="score.html#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="score.html#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Y observado a 0/1 para confusionMatrix</span></span>
<span id="cb117-5"><a href="score.html#cb117-5" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">=</span>  <span class="fu">factor</span>(test_tbl<span class="sc">$</span>default)</span></code></pre></div>
<p>Se estima el modelo lineal (<em>default</em> vs. resto de variables).</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="score.html#cb118-1" aria-hidden="true" tabindex="-1"></a>lm.mod <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">as.numeric</span>(default)<span class="sc">~</span>., <span class="at">data =</span> train_tbl)</span>
<span id="cb118-2"><a href="score.html#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm.mod)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = as.numeric(default) ~ ., data = train_tbl)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.90421 -0.08651 -0.06467 -0.03990  1.18753 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     1.157e+00  6.296e-03 183.764  &lt; 2e-16 ***
## personal_total -3.760e-06  3.623e-06  -1.038 0.299402    
## edad           -1.585e-03  5.894e-05 -26.887  &lt; 2e-16 ***
## nro_atraso3059  2.144e-02  1.059e-03  20.242  &lt; 2e-16 ***
## gastos_ingreso -5.645e-06  1.962e-06  -2.877 0.004010 ** 
## ingreso        -2.315e-03  6.831e-04  -3.389 0.000701 ***
## lineas_credito -6.870e-04  1.776e-04  -3.868 0.000110 ***
## nro_atraso90   -1.354e-02  1.071e-03 -12.651  &lt; 2e-16 ***
## nro_hipoteca    1.685e-03  7.908e-04   2.131 0.033066 *  
## familia_bin     7.086e-03  9.798e-04   7.232 4.78e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2504 on 96205 degrees of freedom
## Multiple R-squared:  0.02673,    Adjusted R-squared:  0.02664 
## F-statistic: 293.6 on 9 and 96205 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="score.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(broom<span class="sc">::</span><span class="fu">glance</span>(lm.mod))</span></code></pre></div>
<pre><code>##                        [,1]
## r.squared      2.673354e-02
## adj.r.squared  2.664249e-02
## sigma          2.504424e-01
## statistic      2.936161e+02
## p.value        0.000000e+00
## df             9.000000e+00
## logLik        -3.305975e+03
## AIC            6.633949e+03
## BIC            6.738167e+03
## deviance       6.034112e+03
## df.residual    9.620500e+04
## nobs           9.621500e+04</code></pre>
<p>Se estima el modelo logit.<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a></p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="score.html#cb122-1" aria-hidden="true" tabindex="-1"></a>glm.mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(formula, <span class="at">data =</span> train_tbl, <span class="at">family =</span> binomial)</span>
<span id="cb122-2"><a href="score.html#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm.mod)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = formula, family = binomial, data = train_tbl)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.3117  -0.4195  -0.3503  -0.2850   3.6748  
## 
## Coefficients:
##                  Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -1.142e+00  1.007e-01 -11.341  &lt; 2e-16 ***
## personal_total -8.713e-05  9.148e-05  -0.953 0.340843    
## edad           -2.770e-02  1.027e-03 -26.979  &lt; 2e-16 ***
## nro_atraso3059  2.548e-01  1.393e-02  18.288  &lt; 2e-16 ***
## gastos_ingreso -2.669e-04  7.694e-05  -3.469 0.000523 ***
## ingreso        -4.414e-02  1.181e-02  -3.738 0.000186 ***
## lineas_credito -9.410e-03  3.021e-03  -3.114 0.001843 ** 
## nro_atraso90   -2.120e-01  1.415e-02 -14.982  &lt; 2e-16 ***
## nro_hipoteca    4.254e-02  1.204e-02   3.533 0.000410 ***
## familia_bin     1.265e-01  1.478e-02   8.555  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 48424  on 96214  degrees of freedom
## Residual deviance: 46551  on 96205  degrees of freedom
## AIC: 46571
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="score.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Efectos marginales ver:</span></span>
<span id="cb124-2"><a href="score.html#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="co">#library(mfx)</span></span>
<span id="cb124-3"><a href="score.html#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="co">#logitmfx(formula, data)</span></span>
<span id="cb124-4"><a href="score.html#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="score.html#cb124-5" aria-hidden="true" tabindex="-1"></a>glm.probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm.mod, test_tbl,  <span class="at">type =</span> <span class="st">&#39;response&#39;</span>)</span>
<span id="cb124-6"><a href="score.html#cb124-6" aria-hidden="true" tabindex="-1"></a>glm.class <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(glm.probs <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb124-7"><a href="score.html#cb124-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-8"><a href="score.html#cb124-8" aria-hidden="true" tabindex="-1"></a>cm_logit <span class="ot">=</span> <span class="fu">confusionMatrix</span>(glm.class, obs, <span class="at">positive =</span> <span class="st">&#39;1&#39;</span>)</span></code></pre></div>
<p>Se estima un árbol simple.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="score.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4321</span>)</span>
<span id="cb125-2"><a href="score.html#cb125-2" aria-hidden="true" tabindex="-1"></a>rpart.mod <span class="ot">=</span> <span class="fu">rpart</span>(formula,</span>
<span id="cb125-3"><a href="score.html#cb125-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> train_tbl,  </span>
<span id="cb125-4"><a href="score.html#cb125-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">minsplit =</span> <span class="dv">20</span>, </span>
<span id="cb125-5"><a href="score.html#cb125-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">minbucket =</span> <span class="dv">6</span>,</span>
<span id="cb125-6"><a href="score.html#cb125-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">cp =</span> <span class="dv">0</span>, </span>
<span id="cb125-7"><a href="score.html#cb125-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">xval =</span> <span class="dv">0</span>, </span>
<span id="cb125-8"><a href="score.html#cb125-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">maxdepth =</span> <span class="dv">16</span>))</span>
<span id="cb125-9"><a href="score.html#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rpart.mod)</span></code></pre></div>
<pre><code>##  [1] &quot;frame&quot;               &quot;where&quot;               &quot;call&quot;               
##  [4] &quot;terms&quot;               &quot;cptable&quot;             &quot;method&quot;             
##  [7] &quot;parms&quot;               &quot;control&quot;             &quot;functions&quot;          
## [10] &quot;numresp&quot;             &quot;splits&quot;              &quot;variable.importance&quot;
## [13] &quot;y&quot;                   &quot;ordered&quot;</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="score.html#cb127-1" aria-hidden="true" tabindex="-1"></a>rpart.prob <span class="ot">=</span> <span class="fu">predict</span>(rpart.mod, test_tbl)</span>
<span id="cb127-2"><a href="score.html#cb127-2" aria-hidden="true" tabindex="-1"></a>rpart.class <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(rpart.prob[, <span class="st">&#39;1&#39;</span>]<span class="sc">&gt;</span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb127-3"><a href="score.html#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="score.html#cb127-4" aria-hidden="true" tabindex="-1"></a>cm_rpart <span class="ot">=</span> <span class="fu">confusionMatrix</span>(rpart.class, obs, <span class="at">positive =</span> <span class="st">&#39;1&#39;</span>)</span>
<span id="cb127-5"><a href="score.html#cb127-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-6"><a href="score.html#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="fu">prp</span>(rpart.mod, <span class="at">extra=</span><span class="dv">101</span>, <span class="at">digits=</span><span class="dv">2</span>, <span class="at">branch=</span><span class="dv">1</span>, <span class="at">type=</span><span class="dv">4</span>, <span class="at">varlen=</span><span class="dv">0</span>, <span class="at">faclen=</span><span class="dv">0</span>)</span></code></pre></div>
<p><img src="NotasTP_files/figure-html/tp10-1.png" width="672" height="40%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="score.html#cb128-1" aria-hidden="true" tabindex="-1"></a>rpartVarImp <span class="ot">=</span> <span class="fu">as_tibble_row</span>(rpart.mod<span class="sc">$</span>variable.importance) <span class="sc">%&gt;%</span></span>
<span id="cb128-2"><a href="score.html#cb128-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-3"><a href="score.html#cb128-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>id, <span class="at">names_to =</span> <span class="st">&#39;Variable&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;Value&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-4"><a href="score.html#cb128-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(<span class="at">id =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Value)) </span>
<span id="cb128-5"><a href="score.html#cb128-5" aria-hidden="true" tabindex="-1"></a>rpartVarImp</span></code></pre></div>
<pre><code>## # A tibble: 9 × 2
##   Variable        Value
##   &lt;chr&gt;           &lt;dbl&gt;
## 1 nro_atraso90   1451. 
## 2 personal_total  748. 
## 3 nro_atraso3059  436. 
## 4 gastos_ingreso  428. 
## 5 ingreso         395. 
## 6 edad            265. 
## 7 lineas_credito  226. 
## 8 nro_hipoteca    112. 
## 9 familia_bin      69.5</code></pre>
<p>Se estima un <em>random forest</em>.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="score.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb130-2"><a href="score.html#cb130-2" aria-hidden="true" tabindex="-1"></a>ranger.mod  <span class="ot">=</span> <span class="fu">ranger</span>(formula,</span>
<span id="cb130-3"><a href="score.html#cb130-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> train_tbl,  </span>
<span id="cb130-4"><a href="score.html#cb130-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">probability =</span> <span class="cn">TRUE</span>,</span>
<span id="cb130-5"><a href="score.html#cb130-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">num.trees =</span> <span class="dv">300</span>, </span>
<span id="cb130-6"><a href="score.html#cb130-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">min.node.size =</span> <span class="dv">15</span>, </span>
<span id="cb130-7"><a href="score.html#cb130-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mtry =</span> <span class="dv">3</span>, </span>
<span id="cb130-8"><a href="score.html#cb130-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">splitrule =</span><span class="st">&#39;gini&#39;</span>,</span>
<span id="cb130-9"><a href="score.html#cb130-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">importance =</span><span class="st">&#39;impurity&#39;</span>)  </span>
<span id="cb130-10"><a href="score.html#cb130-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rpart.mod)</span></code></pre></div>
<pre><code>##  [1] &quot;frame&quot;               &quot;where&quot;               &quot;call&quot;               
##  [4] &quot;terms&quot;               &quot;cptable&quot;             &quot;method&quot;             
##  [7] &quot;parms&quot;               &quot;control&quot;             &quot;functions&quot;          
## [10] &quot;numresp&quot;             &quot;splits&quot;              &quot;variable.importance&quot;
## [13] &quot;y&quot;                   &quot;ordered&quot;</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="score.html#cb132-1" aria-hidden="true" tabindex="-1"></a>ranger.prob <span class="ot">=</span> <span class="fu">predict</span>(ranger.mod, test_tbl)</span>
<span id="cb132-2"><a href="score.html#cb132-2" aria-hidden="true" tabindex="-1"></a>ranger.class <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(ranger.prob<span class="sc">$</span>predictions[, <span class="st">&#39;1&#39;</span>]<span class="sc">&gt;</span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb132-3"><a href="score.html#cb132-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a href="score.html#cb132-4" aria-hidden="true" tabindex="-1"></a>cm_ranger <span class="ot">=</span> <span class="fu">confusionMatrix</span>(ranger.class, obs, <span class="at">positive =</span> <span class="st">&#39;1&#39;</span>)</span>
<span id="cb132-5"><a href="score.html#cb132-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-6"><a href="score.html#cb132-6" aria-hidden="true" tabindex="-1"></a>rangerVarImp <span class="ot">=</span> <span class="fu">as_tibble_row</span>(ranger.mod<span class="sc">$</span>variable.importance) <span class="sc">%&gt;%</span></span>
<span id="cb132-7"><a href="score.html#cb132-7" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb132-8"><a href="score.html#cb132-8" aria-hidden="true" tabindex="-1"></a>               <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>id, <span class="at">names_to =</span> <span class="st">&#39;Variable&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;Value&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb132-9"><a href="score.html#cb132-9" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">id =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span></span>
<span id="cb132-10"><a href="score.html#cb132-10" aria-hidden="true" tabindex="-1"></a>               <span class="fu">arrange</span>(<span class="fu">desc</span>(Value)) </span>
<span id="cb132-11"><a href="score.html#cb132-11" aria-hidden="true" tabindex="-1"></a>rangerVarImp</span></code></pre></div>
<pre><code>## # A tibble: 9 × 2
##   Variable       Value
##   &lt;chr&gt;          &lt;dbl&gt;
## 1 personal_total 1741.
## 2 gastos_ingreso 1330.
## 3 ingreso        1186.
## 4 nro_atraso90   1149.
## 5 edad            839.
## 6 nro_atraso3059  611.
## 7 lineas_credito  607.
## 8 nro_hipoteca    237.
## 9 familia_bin     204.</code></pre>
<p>Se presentan los resultados (no se analizan…) en tabla resumen.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="score.html#cb134-1" aria-hidden="true" tabindex="-1"></a>tab_acc <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">logit  =</span> cm_logit<span class="sc">$</span>overall[[<span class="st">&#39;Accuracy&#39;</span>]],</span>
<span id="cb134-2"><a href="score.html#cb134-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">rpart  =</span> cm_rpart<span class="sc">$</span>overall[[<span class="st">&#39;Accuracy&#39;</span>]],</span>
<span id="cb134-3"><a href="score.html#cb134-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ranger =</span> cm_ranger<span class="sc">$</span>overall[[<span class="st">&#39;Accuracy&#39;</span>]])</span>
<span id="cb134-4"><a href="score.html#cb134-4" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb134-5"><a href="score.html#cb134-5" aria-hidden="true" tabindex="-1"></a>tab_acc <span class="ot">=</span> tab_acc <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to=</span><span class="st">&#39;Modelo&#39;</span>, <span class="at">values_to=</span><span class="st">&#39;Accuracy&#39;</span>) </span>
<span id="cb134-6"><a href="score.html#cb134-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-7"><a href="score.html#cb134-7" aria-hidden="true" tabindex="-1"></a>tab_acc <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Accuracy))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   Modelo Accuracy
##   &lt;chr&gt;     &lt;dbl&gt;
## 1 ranger    0.933
## 2 logit     0.930
## 3 rpart     0.926</code></pre>
</div>
</div>
<h3>Bibliografia<a href="bibliografia.html#bibliografia" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Bazarbash19" class="csl-entry">
Bazarbash, Majid. 2019. <span>«FinTech in Financial Inclusion Machine Learning Applications in Assessing Credit Risk»</span>. <em>IMF Working Paper</em>, n.º 109. <a href="https://www.imf.org/~/media/Files/Publications/WP/2019/WPIEA2019109.ashx">https://www.imf.org/~/media/Files/Publications/WP/2019/WPIEA2019109.ashx</a>.
</div>
<div id="ref-Frost19" class="csl-entry">
Frost, Jon, Leonardo Gambacorta, Yi Huang, Hyun Song Shin, y Pablo Zbinden. 2019. <span>«BigTech and the changing structure of financial intermediation»</span>. <em>BIS Working Papers</em>, n.º 779. <a href="https://www.bis.org/publ/work779.htm">https://www.bis.org/publ/work779.htm</a>.
</div>
<div id="ref-Petropoulos18" class="csl-entry">
Petropoulos, Anastasios, Vasilis Siakoulis, Evaggelos Stavroulakis, y Aristotelis Klamargias. 2018. <span>«A robust machine learning approach for credit risk analysis of large loan-level datasets using deep learning and extreme gradient boosting»</span>. <em>Irving Fisher Committee</em>. <a href="https://www.bis.org/ifc/publ/ifcb49_49.pdf">https://www.bis.org/ifc/publ/ifcb49_49.pdf</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="8">
<li id="fn8"><p>Es importante señalar que la estadística descriptiva sugiere realizar más modificaciones.<a href="score.html#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>Qué sucede si para definir la clase se modifica el umbral <span class="math inline">\(p &gt; 0.5\)</span>?<a href="score.html#fnref9" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="arboles.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bibliografia.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["NotasTP.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
